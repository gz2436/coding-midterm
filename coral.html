<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Coral Reef - Ocean Dreams</title>

  <!-- p5.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/addons/p5.sound.min.js"></script>
  <!-- Feather Icons -->
  <script src="https://unpkg.com/feather-icons"></script>


  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      overflow: hidden;
      font-family: 'Courier New', monospace;
      background: #000;
    }

    #canvas-container {
      width: 100vw;
      height: 100vh;
    }

    .nav-bar {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: rgba(10, 20, 40, 0.8);
      backdrop-filter: blur(10px);
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 100;
      border-bottom: 2px solid rgba(0, 217, 255, 0.3);
    }

    .nav-bar a {
      color: #00d9ff;
      text-decoration: none;
      margin: 0 1rem;
      font-size: 1rem;
      transition: all 0.3s;
    }

    .nav-bar a:hover {
      color: #fff;
      text-shadow: 0 0 10px #00d9ff;
    }

    .nav-bar .home {
      font-size: 1.5rem;
      font-weight: bold;
    }

    .info-panel {
      position: fixed;
      bottom: 2rem;
      left: 2rem;
      background: rgba(10, 20, 40, 0.9);
      backdrop-filter: blur(10px);
      border: 2px solid rgba(0, 217, 255, 0.3);
      border-radius: 10px;
      padding: 1.5rem;
      max-width: 300px;
      color: white;
      z-index: 100;
    }

    .info-panel h2 {
      color: #00d9ff;
      font-size: 1.5rem;
      margin-bottom: 0.5rem;
    }

    .info-panel p {
      font-size: 0.9rem;
      line-height: 1.5;
      color: rgba(255, 255, 255, 0.8);
      margin-bottom: 1rem;
    }

    .controls {
      font-size: 0.85rem;
      color: rgba(255, 255, 255, 0.6);
    }

    .controls div {
      margin: 0.3rem 0;
    }

    .music-btn {
      position: fixed;
      top: 5rem;
      right: 2rem;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: rgba(0, 217, 255, 0.2);
      backdrop-filter: blur(10px);
      border: 2px solid rgba(0, 217, 255, 0.5);
      color: #00d9ff;
      font-size: 1.5rem;
      cursor: pointer;
      z-index: 101;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .music-btn:hover {
      background: rgba(0, 217, 255, 0.4);
      transform: scale(1.1);
      box-shadow: 0 0 20px rgba(0, 217, 255, 0.6);
    }

    .music-btn.playing {
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% {
        box-shadow: 0 0 10px rgba(0, 217, 255, 0.5);
      }
      50% {
        box-shadow: 0 0 30px rgba(0, 217, 255, 0.8);
      }
    }

    @media (max-width: 768px) {
      .nav-bar {
        flex-direction: column;
        padding: 0.5rem;
      }

      .nav-bar a {
        margin: 0.3rem;
        font-size: 0.9rem;
      }

      .info-panel {
        bottom: 1rem;
        left: 1rem;
        right: 1rem;
        max-width: none;
      }
    }
  </style>
</head>
<body>

  <nav class="nav-bar">
    <a href="index.html" class="home">&larr; OCEAN DREAMS</a>
    <div>
      <a href="jellyfish.html">JELLYFISH</a>
      <a href="coral.html">CORAL</a>
      <a href="waves.html">WAVES</a>
      <a href="about.html">ABOUT</a>
    </div>
  </nav>

  <div id="canvas-container"></div>

  <button id="music-btn" class="music-btn" title="Toggle Music">
    <i data-feather="volume-2"></i>
  </button>

  <div class="info-panel">
    <h2>CORAL REEF</h2>
    <p>A vibrant underwater ecosystem with swaying corals, swimming fish, and rising bubbles.</p>
    <div class="controls">
      <div><strong>MOUSE:</strong> Hold to attract fish</div>
      <div><strong>CLICK:</strong> Spawn bubbles</div>
    </div>
  </div>

  <script>
    let corals = [];
    let fishes = [];
    let bubbles = [];

    // Music variables
    let osc1, osc2, osc3, reverb;
    let musicPlaying = false;
    let musicBtn;

    function setup() {
      let canvas = createCanvas(windowWidth, windowHeight);
      canvas.parent('canvas-container');

      // Generate corals
      generateCorals();

      // Generate fish
      for (let i = 0; i < 15; i++) {
        fishes.push(new Fish());
      }

      // Generate bubbles
      for (let i = 0; i < 30; i++) {
        bubbles.push(new Bubble());
      }

      // Setup music
      setupMusic();
      musicBtn = document.getElementById('music-btn');
      musicBtn.addEventListener('click', toggleMusic);

      // Initialize feather icons
      feather.replace();

      // Auto-play music after a short delay
      setTimeout(() => {
        if (!musicPlaying) {
          toggleMusic();
        }
      }, 500);
    }

    function setupMusic() {
      osc1 = new p5.Oscillator('sine');
      osc2 = new p5.Oscillator('sine');
      osc3 = new p5.Oscillator('triangle');

      osc1.freq(82);   // E2
      osc2.freq(123);  // B2
      osc3.freq(196);  // G3

      osc1.amp(0);
      osc2.amp(0);
      osc3.amp(0);

      reverb = new p5.Reverb();
      reverb.process(osc1, 7, 3);
      reverb.process(osc2, 6, 3);
      reverb.process(osc3, 5, 2);

      osc1.start();
      osc2.start();
      osc3.start();

      setInterval(() => {
        if (musicPlaying) {
          let t = millis() / 1000;
          osc1.freq(82 + sin(t * 0.12) * 4);
          osc2.freq(123 + cos(t * 0.18) * 6);
          osc3.freq(196 + sin(t * 0.25) * 10);
        }
      }, 100);
    }

    function toggleMusic() {
      userStartAudio();

      if (musicPlaying) {
        osc1.amp(0, 1);
        osc2.amp(0, 1);
        osc3.amp(0, 1);
        musicBtn.innerHTML = '<i data-feather="volume-x"></i>';
        musicBtn.classList.remove('playing');
        musicPlaying = false;
        feather.replace();
      } else {
        osc1.amp(0.07, 1);
        osc2.amp(0.04, 1);
        osc3.amp(0.03, 1);
        musicBtn.innerHTML = '<i data-feather="volume-2"></i>';
        musicBtn.classList.add('playing');
        musicPlaying = true;
        feather.replace();
      }
    }

    function generateCorals() {
      let positions = [0.2, 0.35, 0.5, 0.65, 0.8];

      positions.forEach(pos => {
        let x = width * pos;
        let baseY = height * 0.8;

        let count = floor(random(2, 5));
        for (let i = 0; i < count; i++) {
          corals.push(new Coral(x + random(-50, 50), baseY, random(0, 360)));
        }
      });
    }

    function windowResized() {
      resizeCanvas(windowWidth, windowHeight);
      corals = [];
      generateCorals();
    }

    function draw() {
      // Ocean gradient background
      setGradient(0, 0, width, height,
        color(15, 76, 129),
        color(3, 34, 76));

      // Draw corals
      corals.forEach(coral => {
        coral.display();
      });

      // Update and draw bubbles
      bubbles.forEach(bubble => {
        bubble.update();
        bubble.display();
      });

      // Update and draw fish
      fishes.forEach(fish => {
        fish.update();
        fish.display();
      });

      // Mouse interaction: attract fish
      if (mouseIsPressed) {
        fishes.forEach(fish => {
          fish.attractTo(mouseX, mouseY);
        });
      }
    }

    class Coral {
      constructor(x, y, hue) {
        this.x = x;
        this.baseY = y;
        this.hue = hue;
        this.branches = [];
        this.generateBranches();
      }

      generateBranches() {
        let branchCount = floor(random(3, 7));
        for (let i = 0; i < branchCount; i++) {
          this.branches.push({
            angle: random(-PI/3, PI/3),
            length: random(30, 80),
            width: random(5, 15),
            segments: floor(random(3, 6))
          });
        }
      }

      display() {
        push();
        translate(this.x, this.baseY);

        this.branches.forEach((branch, i) => {
          push();

          let sway = sin(frameCount * 0.02 + i) * 5;
          rotate(branch.angle + radians(sway));

          for (let seg = 0; seg < branch.segments; seg++) {
            let t = seg / branch.segments;
            let segLength = branch.length / branch.segments;
            let segWidth = branch.width * (1 - t * 0.7);

            let c = color((this.hue + seg * 20) % 360, 80, 70);
            fill(c);
            noStroke();

            ellipse(0, -segLength/2, segWidth, segLength * 1.2);
            translate(0, -segLength);

            if (seg === branch.segments - 1) {
              for (let k = 0; k < 3; k++) {
                push();
                rotate(random(-PI/4, PI/4));
                fill((this.hue + 30) % 360, 90, 80);
                ellipse(0, -10, 3, 15);
                pop();
              }
            }
          }
          pop();
        });
        pop();
      }
    }

    class Fish {
      constructor() {
        this.reset();
        this.hue = random(0, 360);
      }

      reset() {
        this.x = random(-50, width + 50);
        this.y = random(height * 0.1, height * 0.7);
        this.vx = random(1, 3) * (random() > 0.5 ? 1 : -1);
        this.vy = random(-0.5, 0.5);
        this.size = random(15, 35);
      }

      update() {
        this.x += this.vx;
        this.y += this.vy;

        if (this.x < -100 || this.x > width + 100) {
          this.reset();
        }

        this.vy += random(-0.1, 0.1);
        this.vy = constrain(this.vy, -1, 1);
      }

      attractTo(tx, ty) {
        let dx = tx - this.x;
        let dy = ty - this.y;
        let dist = sqrt(dx * dx + dy * dy);

        if (dist < 200 && dist > 10) {
          this.vx += dx / dist * 0.1;
          this.vy += dy / dist * 0.1;
        }
      }

      display() {
        push();
        translate(this.x, this.y);

        let angle = atan2(this.vy, this.vx);
        rotate(angle);

        fill(this.hue, 80, 90);
        noStroke();
        ellipse(0, 0, this.size, this.size * 0.6);

        fill(this.hue, 70, 80);
        triangle(
          -this.size * 0.5, 0,
          -this.size * 0.9, -this.size * 0.3,
          -this.size * 0.9, this.size * 0.3
        );

        fill(255);
        ellipse(this.size * 0.3, 0, this.size * 0.15);
        fill(0);
        ellipse(this.size * 0.32, 0, this.size * 0.08);

        pop();
      }
    }

    class Bubble {
      constructor() {
        this.reset();
      }

      reset() {
        this.x = random(width);
        this.y = height + 10;
        this.size = random(3, 12);
        this.speed = random(0.5, 2);
      }

      update() {
        this.y -= this.speed;
        this.x += sin(frameCount * 0.02 + this.y * 0.01) * 0.5;

        if (this.y < -20) {
          this.reset();
        }
      }

      display() {
        push();
        noFill();
        stroke(255, 255, 255, 150);
        strokeWeight(1.5);
        ellipse(this.x, this.y, this.size);

        noStroke();
        fill(255, 255, 255, 200);
        ellipse(this.x - this.size * 0.2, this.y - this.size * 0.2, this.size * 0.3);
        pop();
      }
    }

    function setGradient(x, y, w, h, c1, c2) {
      noFill();
      for (let i = y; i <= y + h; i++) {
        let inter = map(i, y, y + h, 0, 1);
        let c = lerpColor(c1, c2, inter);
        stroke(c);
        line(x, i, x + w, i);
      }
    }

    function mousePressed() {
      // Spawn extra bubbles
      for (let i = 0; i < 10; i++) {
        bubbles.push(new Bubble());
        bubbles[bubbles.length - 1].x = mouseX + random(-50, 50);
        bubbles[bubbles.length - 1].y = mouseY;
      }
      return false;
    }
  </script>

</body>
</html>
